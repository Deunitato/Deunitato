---
layout: post
title: 'CS2105: Lecture 3 - Socket programming'
date: '2020-02-06T00:38:00.004-08:00'
author: Charlotte Deunitato
tags: 
modified_time: '2020-02-06T00:38:45.367-08:00'
blogger_id: tag:blogger.com,1999:blog-4520250687931855860.post-6679497689890734698
blogger_orig_url: https://nusmods.blogspot.com/2020/02/cs2105-lecture-3-socket-programming.html
---

<h2>Socket Programming</h2><div>Socket: Door between application process and end to end transport protocol</div><div><br /></div><div><i>Each application is run as a process in the OS of the end host. For the two process to communicate with each other, they will need to read and write throguh a programming abstraction called a socket. The application developer has the control of one side of the socket which is at the applicaition layer but has little control over the other side of the socket which is implemented by the transpoert layer services.</i></div><div><i><br />The socket is use to utilized the underlying transport layer services.</i></div><div><br /></div><div><u>&lt;insert slide 8&gt;<br /></u></div><div>Client want to contact an server running the apache server</div><div><br /></div><div>1. Both must have ip adderss</div><div>2. Both processes have to talk to each other though the socket</div><div>3. Both process have TCP sockets.</div><div>4. The port number is use to further identify which process is calling.</div><div>Port number:</div><div>16 bit integer</div><div>1-1023 are reserved for standard use.</div><div><br /></div><div><b>Create sockets:</b></div><div><b>- </b>Corresponding port number</div><div>- Define a destination address</div><div>(Ip address + port number)</div><div><br /></div><div>There are only 2 types of services,</div><div>- UDP</div><div>Unreliable datagram, connectionless</div><div>The packet is define in transport layer</div><div>- TCP</div><div>Reliable service, provides abstraction of byte stream</div><div>It is a stream of bytes.</div><div>Connection oriented</div><div><br /></div><div><b>App example:</b><br />1. The client read a line of data from keyboard and send data to server</div><div>2. server receives the data and convert the chara to upper case</div><div>3. The server sened modified data</div><div>4. The client receives and display the line on screen</div><div><br /></div><h3>UDP Sockets</h3><div>- Connectionless = do not need to do handshaking before communication</div><div>- Sending packet to server: Explicitly attach the IP address and the port number to packet</div><div>(The IPadress and port number can auto identify the process)</div><div>- Receiver receives: Knows the tIP address and port of the sender (client)</div><div>- Receiver reply: Try to extract the ip and port number&nbsp; from the received packet to send it back</div><div>- Receiver sends: Also try to attach IP address</div><div><br /></div><div>However the UPD transmitted data may lost or recieve out of order.</div><div><br /></div><div>Application viewpoint:</div><div>Unreliable transfer of datagram (Packets)</div><div><br /></div><div><br /></div><div>Note: DNS service use UDP as its transport protocol</div><div><br /></div><div><i><u>The server process only use one socket to serve all the different client and queries from different client</u></i></div><div><br /></div><div>1. Server is running</div><div>Specify the port number for server socket</div><div>serverSocket = socket(AF_INET,SOCK_DGRAM)</div><div>2. Client need to create socket and a packet</div><div>clientSocket = socket(AF_INET,SOCK_DGRAM)</div><div>Create a packet with server ip and port. Send packet through clientSocket</div><div>3. Server reply</div><div>Write reply trough serverSocket&nbsp;</div><div>Specify the client address and port number</div><div>4. Once client receives, it can close its socket</div><div><br /></div><div><b>Code example:</b></div><div><b><br /></b></div><div><b><br /></b></div><div><b>Client</b></div><div><b><br /></b></div><div><b>&lt;<u>Insert slide 13&gt;</u></b>- from socket import * (Import)</div><div><br /></div><div>- clientSocket = socket(AF_NET, SOCK_DGRAM) //Create UDP socket for server at client side</div><div>//we can get the ip address by invoking the dns</div><div>//AF_NET = gives the address family (Default IPV4)</div><div>//SOCK_DGRAM = tells the type of the datagram , this says that it is a UDP</div><div><br /></div><div>- message = input("dqdqwdwd")</div><div><br /></div><div>- clientSocket.sendto(message.encode(), serverName, serverPort) //sends this message to this dest</div><div>//encode convert the string to a string of bytes, an array of bytes</div><div><br /></div><div>- modifiedMessage, serverAddress = clientSocket.recvfrom(2048) //recieve from the socket</div><div>//will return two parameters</div><div>//modifiedMessage is the message recieved from somebody&nbsp;</div><div>//Serveraddress is the ipaddress and port number</div><div><br /></div><div>- print(modifiedMessage.decode()) //decoding the modified message backt string</div><div><br /></div><div>- clientSocket.close() //closing the socket</div><div><br /></div><div><b>Server</b></div><div><b><br /></b></div><div><b><u>&lt;Insert slide 14&gt;</u></b></div><div>- serverSocket = socket(AD_INET, SOCK_DRAM)</div><div>//same as client</div><div>//Specify UPD</div><div><br /></div><div>- serverSocket.bind(("", serverPort))</div><div>//tries to bind a server port number to this socket</div><div>// "" says it is a binding method</div><div>// serverPort specify the number</div><div>//reason for binding: Client's port number do not need to worry because the OS will decide for you, we can still bind it nevertheless if we want. (OS will auto assign if we did not specify)</div><div><br /></div><div>-while True //goes into an infinite loop</div><div><br /></div><div>- message, clientAddress = serverSocket.recvfrom(2048)</div><div>//same as client</div><div><br /></div><div>- serverSocket.sendto(modifiedMessage.encode(), clientAddress)</div><div>//encode the changed message</div><div>//sends the back to clientAddress</div><div><br /></div><h3>Socket Programming with TCP (Welcome socket)</h3><div>- Client must contact server</div><div>- Server must be running already</div><div>- Server must have create a socket that welcomes client's contact</div><div><br /></div><div>This socket is different from UDP</div><div>We need specify when we start creating the socket.</div><div>TCP client need to establish a connection to the TCP server</div><div><br /></div><div>Server side</div><div>Must have a welcome side</div><div>Each contacting client, server need to create a socket for each</div><div>Server have multiple sockets and need to identify which client belongs to which socket</div><div>Source port number use to identify</div><div><br /></div><div>Application viewpoint:<br />- Reliable pipe of bytestream transfer&nbsp;</div><div><br /></div><div>1. TCP establish connect</div><div>2. When connection establish, data flows between in continuous stream</div><div>3. When contacted by client, server TCP creates a new socket for server process to communicate with clients</div><div><i>Each client got its own specific socket (Connection socket)</i></div><div>Server use source IP address and port number to identify which socket belongs to who</div><div><br /></div><div><br />1. Server creates a socket, waits for incoming connection</div><div>connectionSocket = serverSocket.accepts()</div><div><br /></div><div>2. Client create a socket</div><div>clientSocket = socket()</div><div><br /></div><div>3. Send request using clientSocket</div><div><br /></div><div>4. Read request from connection socket</div><div><br /></div><div>5. Reply to conectionSocket</div><div><br /></div><div>6. read reply from clientsocket</div><div><br /></div><div>7. Both sides will close the connection</div><div><br /></div><div><i><br /></i></div><div><b>Client side</b></div><div><b><br /></b></div><div><b><u>&lt;insert slide 18&gt;</u></b></div><div><b><br /></b></div><div>- clientSocket = socket(AD_INET, SOCK_STREAM)</div><div>//SOCK_STREAM says its TCP</div><div><br /></div><div>- clientSocket.connect((serverName, serverPort))</div><div>//tries to do a connection first</div><div>//specify the server and the port</div><div>//invokes the handshaking and builds the TCP connection</div><div><br /></div><div>- clientSocket.send(sentence.encode())</div><div>//convert to byte stream</div><div>//no need to attach server name and port, this is because of connect method</div><div><br /></div><div>- modifiedSentence = clientSocket.recv(1024)</div><div>//we know it is recieve from&nbsp;</div><div><br /></div><div><br /></div><div><b>Server side</b></div><div><b>&lt;<u>Insert slide 19&gt;</u></b></div><div><b><br /></b></div><div><b>- </b>serverSocket = socket(AF_INET, SOCK_STREAM)</div><div>- serverSocket.listen(1)</div><div>//this says that it is a welcome socket that listen to incoming request</div><div>//specify the max number of request it can serve simultaneously (here its 1)</div><div><br /></div><div>-while TRUE: //infinite loopp</div><div><br /></div><div>- connectionSocket, addr = serverSocket.accept()</div><div>//some request and we will accept this connection by creating a connectionSocket</div><div>//we will get the client address as well</div><div><br /></div><div>- sentence = connectionSocket.recv(1024).decode()</div><div>//1024 is buffer size</div><div>// we recieve the stream of bytes and we call the decode to translate into string</div><div><br /></div><div>- connectionSocket.send(captilizedsentence.encode())</div><div>//send the encoded sentence</div><div><br /></div><div>- connectionSocket.close&nbsp;</div><div>//close the socket</div><div><br /></div><div><i>If we want the server to serve like 100 client, we can change the number 1 in listener to 100. But in order to serve concurrently, it depends on the libraries and programming languages that are unique to multithreading.</i></div><div><i>For each simultaneous, we have to create a new thread.</i></div><div><i>Unfortunately, for python, there is no such multithreading. We have to use other languages.</i></div><h3>UDP socket vs TCP socket</h3><h4>UDP Socket</h4><div>- Only one socket for all client (Server)</div><div>- No connection establish (both sides)</div><div>- Sender have to explicitly attach destinationIP address and port (client)</div><div>- Unreliable datagram: May lost or out of order (Client)</div><h4>TCP Socket</h4><div>- Welcome socket for all request (server)</div><div>- Each accepted client will have a connection socket each (server)</div><div>- Connection establish (both sides)</div><div>- Reliable stream pipe: Data guaranteed to be received in order (client)</div><div><br /></div><div><br /></div><div><br /></div><div><br /></div>